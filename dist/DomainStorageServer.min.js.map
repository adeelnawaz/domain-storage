{"version":3,"sources":["webpack://[name]/webpack/universalModuleDefinition","webpack://[name]/webpack/bootstrap","webpack://[name]/./src/DomainStorageServer.js","webpack://[name]/webpack/runtime/define property getters","webpack://[name]/webpack/runtime/hasOwnProperty shorthand"],"names":["root","factory","exports","module","define","amd","self","_this","_referrerOrigin","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","_trustedDomains","DomainStorageServer","undefined","window","postMessage","document","referrer","URL","origin","this","console","error","getParentDomain","hostname","split","slice","join","respond","actionId","success","response","top","type","start","addEventListener","event","includes","location","data","action","props","localStorage","getItem","setItem","value","removeItem","Error","handleActionRequest","ready","setTrustedDomains","trustedDomains","Array"],"mappings":"CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,sBAAuB,GAAIH,GACR,iBAAZC,QACdA,QAA6B,oBAAID,IAEjCD,EAA0B,oBAAIC,IARhC,CASGK,MAAM,WACT,M,mBCTA,ICGIC,EACFC,EDJEC,EAAsB,CEA1B,EAAwB,CAACP,EAASQ,KACjC,IAAI,IAAIC,KAAOD,EACXD,EAAoBG,EAAEF,EAAYC,KAASF,EAAoBG,EAAEV,EAASS,IAC5EE,OAAOC,eAAeZ,EAASS,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3E,EAAwB,CAACM,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,I,4BFOlF,IAAII,EAAkB,GAGhBC,EAAsB,WAE1B,QAAcC,IAAVjB,EACF,OAAOA,EAIT,GAAKkB,QAAWA,OAAOC,YAAvB,CAKA,GAAKC,SAASC,SAWd,OANApB,EAAmB,IAAIqB,IAAIF,SAASC,UAAWE,OAI/CvB,EAAQwB,KARNC,QAAQC,MAAM,0BALdD,QAAQC,MAAM,sCAsCZC,EAAkB,SAAAC,GACtB,OAAOA,EAASC,MAAM,KAAKC,OAAO,GAAGC,KAAK,MAwBtCC,EAAU,SAACC,EAAUC,EAASC,GAClCjB,OAAOkB,IAAIjB,YAAY,CACrBkB,KAAM,qBACNJ,WACAC,UACAC,YACClC,IAULe,EAAoBJ,UAAY,CAC9B0B,MA9DY,WAEZpB,OAAOqB,iBAAiB,WAAW,SAACC,GAClC,GAqBsBjB,EApBFiB,EAAMjB,OAqBtBK,EAAY,IAAIN,IAAIC,GAASK,UAE5Bb,EAAgB0B,SAASb,IAAaD,EAAgBC,KAAcD,EAAgBT,OAAOwB,SAASd,YAtBnF,uBAApBY,EAAMG,KAAKN,KAFb,CAKA,MAAuCG,EAAMG,MAsBrB,SAACC,EAAQX,EAAUY,GAC7C,IAAMzC,EAAM,kBAAH,OAAqByC,EAAMzC,KAEpC,OAAQwC,GACN,IAAK,UACH,OAAOZ,EAAQC,GAAU,EAAMa,aAAaC,QAAQ3C,IACtD,IAAK,UACH,OAAO4B,EAAQC,GAAU,EAAMa,aAAaE,QAAQ5C,EAAKyC,EAAMI,QACjE,IAAK,aACH,OAAOjB,EAAQC,GAAU,EAAMa,aAAaI,WAAW9C,IACzD,QACS4B,EAAQC,GAAU,EAAO,IAAIkB,MAAM,4BA9B5CC,CAHA,EAAQR,OAAR,EAAgBX,S,kXAAhB,2BAgBqB,IAACV,EAClBK,KAbH,GAEHV,OAAOkB,IAAIjB,YAAY,CACrBkB,KAAM,qBACNgB,OAAO,GACNpD,IA8CHqD,kBATwB,SAACC,GACrBA,aAA0BC,QAC5BzC,EAAkBwC,KAUtB,YAAoBvC,E","file":"DomainStorageServer.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"DomainStorageServer\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"DomainStorageServer\"] = factory();\n\telse\n\t\troot[\"DomainStorageServer\"] = factory();\n})(self, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","/**\n * DomainStorageServer library\n * Provides a mechanism to share local storage between a parent domain and subdomains\n */\nlet _this,\n  _referrerOrigin\n\nlet _trustedDomains = []\n\n// DomainStorageServer constructor\nconst DomainStorageServer = function () {\n  // Ensure singleton instance\n  if (_this !== undefined) {\n    return _this\n  }\n\n  // Check for support\n  if (!window || !window.postMessage) {\n    console.error('Missing feature support. Exiting!')\n    return\n  }\n  // Check for referrer\n  if (!document.referrer) {\n    console.error('No referrer found')\n    return\n  }\n\n  _referrerOrigin = (new URL(document.referrer)).origin\n\n  // todo initialize a listener that listens, takes action, and responds with another message\n  // Save a reference to this\n  _this = this\n\n  return _this\n}\n\nconst start = () => {\n  // Listen to messages\n  window.addEventListener('message', (event) => {\n    if (\n      !isMessageTrusted(event.origin) || // Message is from somewhere else\n      event.data.type !== 'domain_storage_msg' // Message is not related to domain storage\n    ) return\n\n    const { action, actionId, ...props } = event.data\n\n    // Respond with actionId, success, response\n    handleActionRequest(action, actionId, props)\n  }, false)\n\n  window.top.postMessage({\n    type: 'domain_storage_msg',\n    ready: true\n  }, _referrerOrigin)\n}\n\nconst getParentDomain = hostname => {\n  return hostname.split('.').slice(-2).join('.')\n}\n\nconst isMessageTrusted = (origin) => {\n  const hostname = (new URL(origin)).hostname\n  // todo also verify the source of the message\n  return _trustedDomains.includes(hostname) || getParentDomain(hostname) === getParentDomain(window.location.hostname)\n}\n\nconst handleActionRequest = (action, actionId, props) => {\n  const key = `DomainStorage::${props.key}`\n\n  switch (action) {\n    case 'getItem':\n      return respond(actionId, true, localStorage.getItem(key))\n    case 'setItem':\n      return respond(actionId, true, localStorage.setItem(key, props.value))\n    case 'removeItem':\n      return respond(actionId, true, localStorage.removeItem(key))\n    default:\n      return respond(actionId, false, new Error('Invalid action request'))\n  }\n}\n\nconst respond = (actionId, success, response) => {\n  window.top.postMessage({\n    type: 'domain_storage_msg',\n    actionId,\n    success,\n    response\n  }, _referrerOrigin)\n}\n\nconst setTrustedDomains = (trustedDomains) => {\n  if (trustedDomains instanceof Array) {\n    _trustedDomains = trustedDomains\n  }\n}\n\n// Instance methods\nDomainStorageServer.prototype = {\n  start,\n  setTrustedDomains\n}\n\nexport default (new DomainStorageServer())\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))"],"sourceRoot":""}