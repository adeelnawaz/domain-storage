{"version":3,"sources":["webpack://[name]/webpack/universalModuleDefinition","webpack://[name]/webpack/bootstrap","webpack://[name]/webpack/runtime/define property getters","webpack://[name]/webpack/runtime/hasOwnProperty shorthand","webpack://[name]/webpack/runtime/make namespace object","webpack://[name]/./src/DomainStorageServer.js"],"names":["_this","_referrerOrigin","_trustedDomains","DomainStorageServer","undefined","window","postMessage","console","error","document","referrer","URL","origin","start","addEventListener","event","isMessageTrusted","data","type","action","actionId","props","handleActionRequest","top","ready","getParentDomain","hostname","split","slice","join","host","includes","location","key","respond","localStorage","getItem","setItem","value","removeItem","Error","success","response","setTrustedDomains","trustedDomains","Array","prototype"],"mappings":"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","file":"DomainStorageServer.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"DomainStorageServer\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"DomainStorageServer\"] = factory();\n\telse\n\t\troot[\"DomainStorageServer\"] = factory();\n})(self, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * DomainStorageServer library\n * Provides a mechanism to share local storage between a parent domain and subdomains\n */\nlet _this,\n  _referrerOrigin\n\nlet _trustedDomains = []\n\n// DomainStorageServer constructor\nconst DomainStorageServer = function () {\n  // Ensure singleton instance\n  if (_this !== undefined) {\n    return _this\n  }\n\n  // Check for support\n  if (!window || !window.postMessage) {\n    console.error('Missing feature support. Exiting!')\n    return\n  }\n  // Check for referrer\n  if (!document.referrer) {\n    console.error('No referrer found')\n    return\n  }\n\n  _referrerOrigin = (new URL(document.referrer)).origin\n\n  // todo initialize a listener that listens, takes action, and responds with another message\n  // Save a reference to this\n  _this = this\n\n  return _this\n}\n\nconst start = () => {\n  // Listen to messages\n  window.addEventListener('message', (event) => {\n    if (\n      !isMessageTrusted(event.origin) || // Message is from somewhere else\n      event.data.type !== 'domain_storage_msg' // Message is not related to domain storage\n    ) return\n\n    const { action, actionId, ...props } = event.data\n\n    // Respond with actionId, success, response\n    handleActionRequest(action, actionId, props)\n  }, false)\n\n  window.top.postMessage({\n    type: 'domain_storage_msg',\n    ready: true\n  }, _referrerOrigin)\n}\n\nconst getParentDomain = hostname => {\n  return hostname.split('.').slice(-2).join('.')\n}\n\nconst isMessageTrusted = (origin) => {\n  const host = (new URL(origin)).hostname\n  // todo also verify the source of the message\n  return _trustedDomains.includes(host) || getParentDomain(host) === getParentDomain(window.location.hostname)\n}\n\nconst handleActionRequest = (action, actionId, props) => {\n  const key = `DomainStorage::${props.key}`\n\n  switch (action) {\n    case 'getItem':\n      return respond(actionId, true, localStorage.getItem(key))\n    case 'setItem':\n      return respond(actionId, true, localStorage.setItem(key, props.value))\n    case 'removeItem':\n      return respond(actionId, true, localStorage.removeItem(key))\n    default:\n      return respond(actionId, false, new Error('Invalid action request'))\n  }\n}\n\nconst respond = (actionId, success, response) => {\n  window.top.postMessage({\n    type: 'domain_storage_msg',\n    actionId,\n    success,\n    response\n  }, _referrerOrigin)\n}\n\nconst setTrustedDomains = (trustedDomains) => {\n  if (trustedDomains instanceof Array) {\n    _trustedDomains = trustedDomains\n  }\n}\n\n// Instance methods\nDomainStorageServer.prototype = {\n  start,\n  setTrustedDomains\n}\n\nexport default (new DomainStorageServer())\n"],"sourceRoot":""}